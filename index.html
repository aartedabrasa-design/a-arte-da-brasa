<script>
let carrinho=[];
const taxa=1;
const BASE=10.9;

const cartDiv=document.getElementById("cart");
const preview=document.getElementById("preview");
const toast=document.getElementById("toast");
const pagamento=document.getElementById("pagamento");
const troco=document.getElementById("troco");

setTimeout(()=>document.getElementById("splash").style.display="none",2000);

pagamento.addEventListener("change",()=>{
if(pagamento.value==="Dinheiro"){
troco.classList.remove("hidden");
}else{
troco.classList.add("hidden");
troco.value="";
}
});

function showToast(msg){
toast.innerText=msg;
toast.classList.add("show");
setTimeout(()=>toast.classList.remove("show"),1500);
}

function addItem(nome,preco){
let item=carrinho.find(i=>i.nome===nome);
item?item.qtd++:carrinho.push({nome,preco,qtd:1});
update();
showToast("Adicionado ao carrinho âœ…");
}

function changeQtd(nome,delta){
let item=carrinho.find(i=>i.nome===nome);
item.qtd+=delta;
if(item.qtd<=0) carrinho=carrinho.filter(i=>i.nome!==nome);
update();
}

function update(){
if(!carrinho.length){
cartDiv.innerHTML="Seu carrinho estÃ¡ vazio";
return;
}
let subtotal=0,html="";
carrinho.forEach(i=>{
let sub=i.preco*i.qtd;
subtotal+=sub;
html+=`<div class="cart-item">
<b>${i.nome}</b>
<div class="counter">
<button onclick="changeQtd('${i.nome}',-1)">âˆ’</button>
${i.qtd}
<button onclick="changeQtd('${i.nome}',1)">+</button>
 | R$ ${sub.toFixed(2)}
</div></div>`;
});
let total=subtotal+taxa;
html+=`<div class="taxa">Subtotal: R$ ${subtotal.toFixed(2)}</div>
<div class="taxa">Taxa: R$ ${taxa.toFixed(2)}</div>
<div class="total">Total: R$ ${total.toFixed(2)}</div>`;
cartDiv.innerHTML=html;
}

function calcularPreview(){
let total=BASE;
let qtd=Number(qtdCarne.value)||1;
total+=Number(pao.value);
total+=Number(carne.value)*qtd;
total+=Number(molho.value);
document.querySelectorAll(".builder-grid input:checked")
.forEach(e=>total+=Number(e.value));
preview.innerText="PreÃ§o: R$ "+total.toFixed(2);
}

document.querySelectorAll("#pao,#carne,#molho,#qtdCarne,.builder-grid input")
.forEach(e=>e.addEventListener("change",calcularPreview));

calcularPreview();

function addCustom(){
let total=BASE;
let qtd=Number(qtdCarne.value)||1;
let nome="Monte seu Lanche: ";
total+=Number(pao.value);
total+=Number(carne.value)*qtd;
total+=Number(molho.value);
if(qtd>1) nome+=qtd+"x ";
[pao,carne,molho].forEach(s=>{
if(s.value!=0) nome+=s.options[s.selectedIndex].text+", ";
});
document.querySelectorAll(".builder-grid input:checked")
.forEach(e=>{
total+=Number(e.value);
nome+=e.parentElement.innerText+", ";
});
addItem(nome.slice(0,-2),total);
}

/* ðŸ”¥ FUNÃ‡ÃƒO FINALIZAR AJUSTADA PARA 58MM */

function finalizar(){
if(!carrinho.length){
alert("Adicione itens primeiro ðŸ˜‰");
return;
}

const nome=document.getElementById("nome").value.trim();
const endereco=document.getElementById("endereco").value.trim();
const pagamentoValue=pagamento.value;
const trocoValue=troco.value;
const obs=document.getElementById("obs").value.trim();

if(!nome||!endereco||!pagamentoValue){
alert("Preencha Nome, EndereÃ§o e Pagamento ðŸ˜‰");
return;
}

let subtotal=0;
let linhas=[];

linhas.push("PEDIDO - A ARTE DA BRASA");
linhas.push("");

linhas.push("Cliente:");
linhas.push(nome);
linhas.push("");

linhas.push("EndereÃ§o:");
linhas.push(endereco);
linhas.push("");

linhas.push("Pagamento: " + pagamentoValue);

if(pagamentoValue==="Dinheiro" && trocoValue){
linhas.push("Troco para: R$ " + trocoValue);
}

if(obs){
linhas.push("");
linhas.push("Obs:");
linhas.push(obs);
}

linhas.push("");
linhas.push("------------------------------");
linhas.push("ITENS:");
linhas.push("");

carrinho.forEach(i=>{
let sub=i.preco*i.qtd;
subtotal+=sub;

linhas.push(i.qtd + "x " + i.nome);
linhas.push("R$ " + sub.toFixed(2));
linhas.push("");
});

let total=subtotal+taxa;

linhas.push("------------------------------");
linhas.push("Subtotal: R$ " + subtotal.toFixed(2));
linhas.push("Taxa: R$ " + taxa.toFixed(2));
linhas.push("");
linhas.push("TOTAL: R$ " + total.toFixed(2));
linhas.push("------------------------------");

let mensagem = linhas.join("\n");

window.open("https://wa.me/5543996795964?text="+encodeURIComponent(mensagem),"_blank");

carrinho=[];
update();
showToast("Pedido enviado com sucesso ðŸš€");
}
</script>
